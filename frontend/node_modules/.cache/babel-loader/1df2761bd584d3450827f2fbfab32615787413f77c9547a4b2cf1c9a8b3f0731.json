{"ast":null,"code":"var _jsxFileName = \"/Users/zhang/Desktop/smartyoga/frontend/src/contexts/TrainingContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect, useCallback } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TrainingContext = /*#__PURE__*/createContext();\nexport const useTraining = () => {\n  _s();\n  return useContext(TrainingContext);\n};\n_s(useTraining, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const TrainingProvider = ({\n  children\n}) => {\n  _s2();\n  const [poseDetector, setPoseDetector] = useState(null);\n  const [isDetecting, setIsDetecting] = useState(false);\n  const [keypoints, setKeypoints] = useState(null);\n  const [webcamRef, setWebcamRef] = useState(null);\n  const [error, setError] = useState(null);\n\n  // 初始化姿势检测器\n  const initPoseDetector = useCallback(async () => {\n    try {\n      if (!window.poseDetection) {\n        setError('找不到姿势检测库。请确保MediaPipe资源已正确加载。');\n        return;\n      }\n      const detector = await window.poseDetection.createDetector(window.poseDetection.SupportedModels.BlazePose, {\n        runtime: 'mediapipe',\n        modelType: 'full',\n        solutionPath: '/mediapipe/'\n      });\n      setPoseDetector(detector);\n      console.log('姿势检测器初始化成功');\n    } catch (error) {\n      console.error('初始化姿势检测器时出错:', error);\n      setError('无法初始化姿势检测器。请刷新页面或检查设备兼容性。');\n    }\n  }, []);\n\n  // 开始姿势检测\n  const startDetection = useCallback(async () => {\n    if (!poseDetector) {\n      await initPoseDetector();\n    }\n    setIsDetecting(true);\n  }, [poseDetector, initPoseDetector]);\n\n  // 停止姿势检测\n  const stopDetection = useCallback(() => {\n    setIsDetecting(false);\n  }, []);\n\n  // 检测循环\n  useEffect(() => {\n    if (!isDetecting || !poseDetector || !webcamRef || !webcamRef.current) return;\n    let detectionFrame;\n    const detect = async () => {\n      if (webcamRef.current && webcamRef.current.video && webcamRef.current.video.readyState === 4) {\n        try {\n          const video = webcamRef.current.video;\n          const poses = await poseDetector.estimatePoses(video);\n          if (poses && poses.length > 0) {\n            // 将姿势关键点转换为标准化格式\n            const normalizedKeypoints = normalizeKeypoints(poses[0].keypoints);\n            setKeypoints(normalizedKeypoints);\n          }\n        } catch (error) {\n          console.error('姿势检测时出错:', error);\n        }\n      }\n      if (isDetecting) {\n        detectionFrame = requestAnimationFrame(detect);\n      }\n    };\n    detect();\n    return () => {\n      if (detectionFrame) {\n        cancelAnimationFrame(detectionFrame);\n      }\n    };\n  }, [isDetecting, poseDetector, webcamRef]);\n\n  // 将MediaPipe关键点转换为我们的标准格式\n  const normalizeKeypoints = keypointsArray => {\n    const result = {};\n    const keypointMap = {\n      0: 'nose',\n      11: 'leftShoulder',\n      12: 'rightShoulder',\n      13: 'leftElbow',\n      14: 'rightElbow',\n      15: 'leftWrist',\n      16: 'rightWrist',\n      23: 'leftHip',\n      24: 'rightHip',\n      25: 'leftKnee',\n      26: 'rightKnee',\n      27: 'leftAnkle',\n      28: 'rightAnkle'\n    };\n    keypointsArray.forEach((keypoint, index) => {\n      if (keypointMap[index]) {\n        result[keypointMap[index]] = {\n          x: keypoint.x,\n          y: keypoint.y,\n          score: keypoint.score || 0\n        };\n      }\n    });\n    return result;\n  };\n  const setWebcam = ref => {\n    setWebcamRef(ref);\n  };\n  const value = {\n    poseDetector,\n    isDetecting,\n    keypoints,\n    error,\n    setWebcam,\n    startDetection,\n    stopDetection,\n    initPoseDetector\n  };\n  return /*#__PURE__*/_jsxDEV(TrainingContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 5\n  }, this);\n};\n_s2(TrainingProvider, \"VLSvZgWOZwmH275pubNz2owZFvw=\");\n_c = TrainingProvider;\nvar _c;\n$RefreshReg$(_c, \"TrainingProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","useCallback","jsxDEV","_jsxDEV","TrainingContext","useTraining","_s","TrainingProvider","children","_s2","poseDetector","setPoseDetector","isDetecting","setIsDetecting","keypoints","setKeypoints","webcamRef","setWebcamRef","error","setError","initPoseDetector","window","poseDetection","detector","createDetector","SupportedModels","BlazePose","runtime","modelType","solutionPath","console","log","startDetection","stopDetection","current","detectionFrame","detect","video","readyState","poses","estimatePoses","length","normalizedKeypoints","normalizeKeypoints","requestAnimationFrame","cancelAnimationFrame","keypointsArray","result","keypointMap","forEach","keypoint","index","x","y","score","setWebcam","ref","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/zhang/Desktop/smartyoga/frontend/src/contexts/TrainingContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect, useCallback } from 'react';\n\nconst TrainingContext = createContext();\n\nexport const useTraining = () => useContext(TrainingContext);\n\nexport const TrainingProvider = ({ children }) => {\n  const [poseDetector, setPoseDetector] = useState(null);\n  const [isDetecting, setIsDetecting] = useState(false);\n  const [keypoints, setKeypoints] = useState(null);\n  const [webcamRef, setWebcamRef] = useState(null);\n  const [error, setError] = useState(null);\n  \n  // 初始化姿势检测器\n  const initPoseDetector = useCallback(async () => {\n    try {\n      if (!window.poseDetection) {\n        setError('找不到姿势检测库。请确保MediaPipe资源已正确加载。');\n        return;\n      }\n      \n      const detector = await window.poseDetection.createDetector(\n        window.poseDetection.SupportedModels.BlazePose,\n        {\n          runtime: 'mediapipe',\n          modelType: 'full',\n          solutionPath: '/mediapipe/'\n        }\n      );\n      \n      setPoseDetector(detector);\n      console.log('姿势检测器初始化成功');\n    } catch (error) {\n      console.error('初始化姿势检测器时出错:', error);\n      setError('无法初始化姿势检测器。请刷新页面或检查设备兼容性。');\n    }\n  }, []);\n  \n  // 开始姿势检测\n  const startDetection = useCallback(async () => {\n    if (!poseDetector) {\n      await initPoseDetector();\n    }\n    \n    setIsDetecting(true);\n  }, [poseDetector, initPoseDetector]);\n  \n  // 停止姿势检测\n  const stopDetection = useCallback(() => {\n    setIsDetecting(false);\n  }, []);\n  \n  // 检测循环\n  useEffect(() => {\n    if (!isDetecting || !poseDetector || !webcamRef || !webcamRef.current) return;\n    \n    let detectionFrame;\n    \n    const detect = async () => {\n      if (\n        webcamRef.current && \n        webcamRef.current.video && \n        webcamRef.current.video.readyState === 4\n      ) {\n        try {\n          const video = webcamRef.current.video;\n          const poses = await poseDetector.estimatePoses(video);\n          \n          if (poses && poses.length > 0) {\n            // 将姿势关键点转换为标准化格式\n            const normalizedKeypoints = normalizeKeypoints(poses[0].keypoints);\n            setKeypoints(normalizedKeypoints);\n          }\n        } catch (error) {\n          console.error('姿势检测时出错:', error);\n        }\n      }\n      \n      if (isDetecting) {\n        detectionFrame = requestAnimationFrame(detect);\n      }\n    };\n    \n    detect();\n    \n    return () => {\n      if (detectionFrame) {\n        cancelAnimationFrame(detectionFrame);\n      }\n    };\n  }, [isDetecting, poseDetector, webcamRef]);\n  \n  // 将MediaPipe关键点转换为我们的标准格式\n  const normalizeKeypoints = (keypointsArray) => {\n    const result = {};\n    const keypointMap = {\n      0: 'nose',\n      11: 'leftShoulder',\n      12: 'rightShoulder',\n      13: 'leftElbow',\n      14: 'rightElbow',\n      15: 'leftWrist',\n      16: 'rightWrist',\n      23: 'leftHip',\n      24: 'rightHip',\n      25: 'leftKnee',\n      26: 'rightKnee',\n      27: 'leftAnkle',\n      28: 'rightAnkle'\n    };\n    \n    keypointsArray.forEach((keypoint, index) => {\n      if (keypointMap[index]) {\n        result[keypointMap[index]] = {\n          x: keypoint.x,\n          y: keypoint.y,\n          score: keypoint.score || 0\n        };\n      }\n    });\n    \n    return result;\n  };\n  \n  const setWebcam = (ref) => {\n    setWebcamRef(ref);\n  };\n  \n  const value = {\n    poseDetector,\n    isDetecting,\n    keypoints,\n    error,\n    setWebcam,\n    startDetection,\n    stopDetection,\n    initPoseDetector\n  };\n  \n  return (\n    <TrainingContext.Provider value={value}>\n      {children}\n    </TrainingContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}